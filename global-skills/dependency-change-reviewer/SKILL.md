---
name: 依存パッケージ変更レビュー
description: 依存追加・アップデート時の確認観点を固定。新ライブラリ導入、バージョン更新時に使用。
---

# 依存パッケージ変更レビュー Skill

依存パッケージの追加・更新時に確認すべき観点をチェックします。

## レビューチェックリスト

### 1. ライセンス確認

#### 許可されるライセンス（一般的）

| ライセンス | 商用利用 | 注意点 |
|-----------|---------|--------|
| MIT | ✅ | 著作権表示が必要 |
| Apache 2.0 | ✅ | 著作権表示・変更点の明示 |
| BSD (2/3-Clause) | ✅ | 著作権表示が必要 |
| ISC | ✅ | 著作権表示が必要 |

#### 注意が必要なライセンス

| ライセンス | 注意点 |
|-----------|--------|
| GPL | コードの公開義務（リンク方法による） |
| LGPL | 動的リンクなら利用可能 |
| AGPL | ネットワーク経由でも公開義務 |
| CC-BY-NC | 商用利用不可 |
| Proprietary | 個別確認が必要 |

#### 確認コマンド

```bash
# npm パッケージのライセンス確認
npm view [package-name] license

# 全依存のライセンス一覧
npx license-checker --summary

# 禁止ライセンスの検出
npx license-checker --failOn "GPL;AGPL"
```

### 2. 脆弱性確認

```bash
# npm audit
npm audit

# 詳細レポート
npm audit --json

# 修正可能な脆弱性の自動修正
npm audit fix

# Snyk による詳細チェック
npx snyk test
```

#### 脆弱性の重要度

| レベル | 対応 |
|-------|------|
| Critical | 即座に対応、代替を検討 |
| High | マージ前に対応 |
| Moderate | 計画的に対応 |
| Low | 把握しておく |

### 3. パッケージ品質

#### チェック項目

| 観点 | 確認方法 | 基準 |
|-----|---------|------|
| メンテナンス | 最終更新日 | 6ヶ月以内が望ましい |
| 人気度 | 週間ダウンロード数 | 1万以上が望ましい |
| Issue対応 | Open Issue 数 | 放置されていないか |
| テスト | CI バッジ | テストが通っているか |
| 型定義 | TypeScript 対応 | @types が存在するか |

#### 確認コマンド

```bash
# パッケージ情報の確認
npm view [package-name]

# ダウンロード数
npm view [package-name] --json | jq '.downloads'

# 依存関係の確認
npm view [package-name] dependencies
```

### 4. サイズ・ビルド影響

```bash
# バンドルサイズの確認
npx bundlephobia [package-name]

# ローカルでのサイズ確認
npm pack [package-name] --dry-run

# 依存の深さ確認
npm ls [package-name]
```

#### 判断基準

| サイズ | 判断 |
|-------|------|
| < 10KB | 小さい、問題なし |
| 10-100KB | 中程度、用途に見合うか確認 |
| > 100KB | 大きい、代替を検討 |
| > 1MB | 非常に大きい、強い理由が必要 |

### 5. 代替候補の検討

#### 比較観点

| 観点 | 確認内容 |
|-----|---------|
| 機能 | 必要な機能が揃っているか |
| サイズ | より軽量な代替があるか |
| メンテナンス | 活発にメンテナンスされているか |
| コミュニティ | ドキュメント・サポートが充実しているか |
| 互換性 | 既存コードとの互換性 |

#### 検索方法

```bash
# npm での類似パッケージ検索
npm search [keyword]

# bundlephobia での比較
# https://bundlephobia.com/compare
```

### 6. ロックファイルの確認

#### チェック項目

- [ ] `package-lock.json` / `yarn.lock` が更新されているか
- [ ] 意図しない依存の更新がないか
- [ ] 開発依存（devDependencies）か本番依存（dependencies）か適切か

```bash
# ロックファイルの差分確認
git diff package-lock.json

# 依存関係の可視化
npm ls --depth=1
```

### 7. 破壊的変更の確認（アップデート時）

#### メジャーバージョンアップ時

- [ ] CHANGELOG / リリースノートを確認
- [ ] マイグレーションガイドを確認
- [ ] 破壊的変更の一覧を確認
- [ ] 非推奨 API の使用箇所を確認

```bash
# 変更履歴の確認
npm view [package-name] changelog

# 特定バージョン間の比較
npm diff [package-name]@1.0.0 [package-name]@2.0.0
```

## 出力形式

```markdown
# 依存パッケージ変更レビュー

## サマリー

| 項目 | 内容 |
|-----|------|
| パッケージ名 | [名前] |
| 変更種別 | 新規追加 / バージョン更新 / 削除 |
| バージョン | [現在] → [変更後] |
| 判定 | APPROVE / NEEDS DISCUSSION / REJECT |

## チェック結果

| 観点 | 結果 | 詳細 |
|-----|------|------|
| ライセンス | ✅/⚠️/❌ | [ライセンス名] |
| 脆弱性 | ✅/⚠️/❌ | [件数・レベル] |
| メンテナンス | ✅/⚠️/❌ | 最終更新: [日付] |
| サイズ | ✅/⚠️/❌ | [サイズ] |
| 型定義 | ✅/⚠️/❌ | [有無] |

## 詳細

### 採用理由
[なぜこのパッケージが必要か]

### 代替候補
| パッケージ | 比較結果 |
|-----------|---------|
| [代替1] | [比較内容] |

### リスク
- [リスク1]

### 対応事項
- [ ] [対応1]

## 結論

[採用可否の結論と理由]
```

## 判定基準

| 判定 | 条件 |
|-----|------|
| APPROVE | 全チェック OK |
| NEEDS DISCUSSION | 軽微な懸念あり、チームで議論 |
| REJECT | 重大な問題あり（脆弱性、ライセンス違反等） |
