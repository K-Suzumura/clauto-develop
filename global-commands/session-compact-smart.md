---
name: session-compact-smart
description: Smart compaction to prevent long session issues
disable-model-invocation: true
---

# /session:compact-smart - スマートコンパクト

長時間セッションの事故を防ぐため、コンパクト化と状態の保存を行ってください。

## 実行内容

1. 現在のセッション状態を記録
2. `/compact` を実行
3. 重要な決定事項とTODOを再記録

## 実行タイミングの目安

- 長時間（1時間以上）作業した場合
- 大きな機能実装が完了した場合
- コンテキストが複雑になってきた場合
- 「前に話したこと」を忘れ始めた兆候がある場合

## 保存する情報

### 1. プロジェクト状態
- 現在のブランチ
- 未コミットの変更
- 進行中のタスク

### 2. 重要な決定事項
- アーキテクチャの決定
- 技術選定の理由
- 設計上の判断

### 3. TODO/次のアクション
- 未完了のタスク
- 次に取り組むべきこと
- 保留中の課題

### 4. 注意事項
- 既知の問題
- ワークアラウンド
- 避けるべきこと

## 実行フロー

### Phase 1: 状態記録
```markdown
## セッション状態サマリー

### 現在の作業
- ブランチ: feature/F-001-user-authentication
- タスク: T-003 (進行中)
- 最後の操作: [操作内容]

### 重要な決定事項
1. [決定1]: [理由]
2. [決定2]: [理由]

### TODO
- [ ] [TODO1]
- [ ] [TODO2]

### 注意事項
- [注意1]
- [注意2]
```

### Phase 2: コンパクト実行
- `/compact` を呼び出し
- コンテキストを圧縮

### Phase 3: 状態復元
- 記録した状態をコンパクト後のコンテキストに再注入
- 継続性を確保

## 出力形式

```markdown
# セッションコンパクト完了

## コンパクト前の状態

### プロジェクト
- **ブランチ**: feature/F-001-user-authentication
- **未コミット変更**: 3ファイル

### 進行状況
- **完了タスク**: T-001, T-002
- **進行中**: T-003
- **残り**: T-004, T-005

## 引き継ぎ事項

### 重要な決定
1. **認証方式**: JWT + リフレッシュトークン
   - 理由: セキュリティとUXのバランス
2. **状態管理**: Context API
   - 理由: 規模が小さいためRedux不要

### 次のアクション
1. T-003 の残り実装（ログアウト処理）
2. T-004 開始前にテスト追加

### 注意事項
- `src/auth/token.ext` の TODO コメントを確認
- テストのモック設定が不完全

## セッション継続
コンパクト完了しました。上記の引き継ぎ事項を把握した上で作業を継続できます。

次のアクション: T-003 のログアウト処理の実装を続けますか？
```

## 注意事項

- 頻繁に実行しすぎない（必要な時のみ）
- 重要な情報が失われていないか確認
- コンパクト後は状態の確認を行う
