---
name: pr-reviewer
description: Fixed PR review criteria. Checks spec compliance, test coverage, and safety.
---

# PRレビュー Skill

Pull Request を体系的にレビューし、品質を確保します。

> **関連コマンド**: `/git:pr` `/gh:commit-push-pr` がこのSkillの観点でPR本文を生成します。
> **関連エージェント**: `code-reviewer` がこのSkillの基準でレビューを実施します。

## レビューチェックリスト

### 1. 仕様準拠

- [ ] PR の目的が明確に記載されているか
- [ ] 関連する Issue/チケットがリンクされているか
- [ ] 仕様書の要件を満たしているか
- [ ] 仕様書にない機能が追加されていないか
- [ ] 受け入れ基準を満たしているか

### 2. 影響範囲

- [ ] 変更されたファイルが適切か
- [ ] 予期しないファイルの変更がないか
- [ ] 影響を受ける他機能が特定されているか
- [ ] 依存するモジュールへの影響が考慮されているか

### 3. 後方互換性

- [ ] 既存 API の破壊的変更がないか
- [ ] 破壊的変更がある場合、マイグレーション方法が提供されているか
- [ ] データベーススキーマ変更の互換性
- [ ] 設定ファイルの互換性

### 4. テスト

- [ ] 新機能に対するテストがあるか
- [ ] エッジケースのテストがあるか
- [ ] 既存テストが壊れていないか
- [ ] テストカバレッジは十分か
- [ ] 統合テスト/E2E テストが必要か

### 5. ログ/メトリクス

- [ ] 重要な処理にログが出力されているか
- [ ] ログレベルは適切か
- [ ] 機密情報がログに含まれていないか
- [ ] 監視/アラートに必要なメトリクスがあるか

### 6. セキュリティ

- [ ] 入力値のバリデーションがあるか
- [ ] SQL インジェクション対策
- [ ] XSS 対策
- [ ] 認証/認可の確認
- [ ] 機密情報のハードコードがないか
- [ ] 依存パッケージの脆弱性

### 7. パフォーマンス

- [ ] N+1 問題がないか
- [ ] 不要なループがないか
- [ ] 適切なインデックスがあるか
- [ ] キャッシュの考慮
- [ ] 大量データ処理時の考慮

### 8. コード品質

- [ ] 命名は明確か
- [ ] 関数の責務は単一か
- [ ] 重複コードがないか
- [ ] エラーハンドリングは適切か
- [ ] コメントは必要十分か

### 9. ドキュメント

- [ ] README の更新が必要か
- [ ] API ドキュメントの更新
- [ ] 変更履歴の記載
- [ ] 設定変更の説明

## レビューコメントの書き方

### 種別プレフィックス

| プレフィックス | 意味 | 対応 |
|--------------|------|------|
| `[MUST]` | 必須修正 | マージ前に修正必須 |
| `[SHOULD]` | 推奨修正 | できれば修正 |
| `[QUESTION]` | 質問 | 回答待ち |
| `[NIT]` | 細かい指摘 | 任意対応 |
| `[PRAISE]` | 良い点 | 参考/称賛 |

### コメント例

```markdown
[MUST] SQL インジェクションの脆弱性があります。
プレースホルダーを使用してください。

```typescript
// 現状（危険）
const query = `SELECT * FROM users WHERE id = '${userId}'`;

// 修正案
const query = 'SELECT * FROM users WHERE id = $1';
const result = await db.query(query, [userId]);
```
```

## 出力形式

```markdown
# PR レビュー結果

## サマリー
- **PR**: #[番号] [タイトル]
- **判定**: [Approve / Request Changes / Comment]
- **MUST**: [件数]
- **SHOULD**: [件数]

## チェック結果

| カテゴリ | 結果 | 備考 |
|---------|------|------|
| 仕様準拠 | ✅/⚠️/❌ | [備考] |
| 影響範囲 | ✅/⚠️/❌ | [備考] |
| 後方互換性 | ✅/⚠️/❌ | [備考] |
| テスト | ✅/⚠️/❌ | [備考] |
| セキュリティ | ✅/⚠️/❌ | [備考] |
| パフォーマンス | ✅/⚠️/❌ | [備考] |
| コード品質 | ✅/⚠️/❌ | [備考] |
| ドキュメント | ✅/⚠️/❌ | [備考] |

## 指摘事項

### [MUST] 必須修正

#### 1. [タイトル]
- **ファイル**: [パス:行番号]
- **問題**: [問題の説明]
- **修正案**: [具体的な修正提案]

### [SHOULD] 推奨修正

#### 1. [タイトル]
- **ファイル**: [パス:行番号]
- **提案**: [改善提案]

### [QUESTION] 質問

1. [質問内容]

## 良い点

- [良かった点1]
- [良かった点2]

## 総評

[全体的なコメント]
```

## 判定基準

| 判定 | 条件 |
|-----|------|
| Approve | MUST がゼロ |
| Request Changes | MUST が1件以上 |
| Comment | 質問があり、回答待ち |
