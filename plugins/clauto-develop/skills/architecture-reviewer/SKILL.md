---
name: アーキテクチャレビュー
description: 責務分離・ディレクトリ/レイヤ設計のレビュー。大きめの機能追加、初期構築、リファクタ前に使用。
---

# アーキテクチャレビュー Skill

責務分離とレイヤ設計の観点からアーキテクチャをレビューします。

## レビュー観点

### 1. レイヤ境界チェック

#### 標準レイヤ構成
```
┌─────────────────────────────────────┐
│  Presentation (UI / API)            │  ← 入力受付・出力整形
├─────────────────────────────────────┤
│  Application (Use Case)             │  ← ユースケース実行
├─────────────────────────────────────┤
│  Domain (Business Logic)            │  ← ビジネスルール
├─────────────────────────────────────┤
│  Infrastructure (DB / External API) │  ← 外部リソースアクセス
└─────────────────────────────────────┘
```

#### チェック項目
- [ ] 各レイヤの責務が明確か
- [ ] 上位レイヤから下位レイヤへの依存のみか
- [ ] Domain が Infrastructure に依存していないか
- [ ] 依存の方向が一貫しているか

### 2. 境界の明確さ

| 境界 | 確認事項 |
|-----|---------|
| Domain / Application | ユースケースとビジネスルールが分離されているか |
| Application / Infrastructure | 永続化の詳細が漏れていないか |
| Presentation / Application | UI ロジックとビジネスロジックが分離されているか |

### 3. 循環依存チェック

```bash
# 循環依存の検出コマンド例
npx madge --circular src/
```

- [ ] モジュール間の循環依存がないか
- [ ] パッケージ間の循環依存がないか
- [ ] 不要な相互参照がないか

### 4. I/O 層の分離

- [ ] DB アクセスが Repository パターンで抽象化されているか
- [ ] 外部 API がクライアントクラスで抽象化されているか
- [ ] ファイル I/O が抽象化されているか
- [ ] テスト時にモック可能か

### 5. 責務の単一性

| 確認対象 | チェック項目 |
|---------|-------------|
| クラス | 1つの責務に集中しているか |
| モジュール | 1つの機能領域を担当しているか |
| 関数 | 1つの処理を行っているか |

### 6. 将来拡張点の明示

- [ ] 拡張ポイントが interface/abstract で定義されているか
- [ ] プラグイン機構が必要な箇所はあるか
- [ ] 設定の外部化が適切か
- [ ] 機能フラグの仕組みがあるか

## 出力形式

```markdown
# アーキテクチャレビュー結果

## サマリー
- レビュー対象: [ディレクトリ/機能]
- 判定: [PASS / NEEDS IMPROVEMENT / MAJOR ISSUES]
- 重大な問題: [件数]
- 改善提案: [件数]

## アーキテクチャ図（現状）

```
[現状の構成図]
```

## 問題点

### 重大な問題

#### 問題1: [タイトル]
- **箇所**: [ファイル/モジュール]
- **種別**: [循環依存 / 責務違反 / レイヤ越境 / 抽象化不足]
- **説明**: [問題の詳細]
- **影響**: [この問題が引き起こすリスク]
- **修正案**:
  ```
  [修正後の構成図/コード]
  ```

### 改善提案

#### 提案1: [タイトル]
- **箇所**: [ファイル/モジュール]
- **現状**: [現在の状態]
- **提案**: [改善案]
- **メリット**: [改善による効果]

## 将来拡張への対応

### 拡張ポイント
| 拡張シナリオ | 現状の対応度 | 推奨対応 |
|-------------|------------|---------|
| [シナリオ1] | 対応済/要対応 | [対応方法] |

### 技術的負債
| 項目 | 優先度 | 対応時期の目安 |
|-----|-------|--------------|
| [負債1] | 高/中/低 | [時期] |

## 推奨アクション
1. [最優先で対応すべき項目]
2. [次に対応すべき項目]
```

## 判定基準

| 判定 | 条件 |
|-----|------|
| PASS | 重大な問題がなく、軽微な改善点のみ |
| NEEDS IMPROVEMENT | 重大な問題が1-2件、機能追加と並行して対応可能 |
| MAJOR ISSUES | 重大な問題が3件以上、先に修正が必要 |
